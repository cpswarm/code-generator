<?xml version="1.0" encoding="UTF-8"?>
<scxml xmlns="http://www.w3.org/2005/07/scxml"
	xmlns:cpswarm="http://my.custom-actions.domain/cpswarm/CUSTOM"
	version="1.0" initial="SarBehavior" name="sar">
	
	<!-- ******************** SAR MAIN ******************** -->
	<parallel id="SarThreads">
	
		<!-- ******************** SAR BEHAVIOR ******************** -->
		<state id="SarBehavior">

			<state id="StartUp">
				<datamodel>
					<data id="invoke"><rosservice><name>cmd/startup</name><srv>StartUp</srv><request empty="true"/></rosservice>
					</data>
				</datamodel>
				<invoke type="ROS_SERVICE" />
				<transition event="succeeded" target="Idle" />
			</state>

			<state id="Idle">
				<transition event="missionStart" target="TakeOff" />
			</state>

			<state id="TakeOff">
				<datamodel>
					<data id="invoke"><rosservice><name>cmd/takeoff</name><srv>TakeOff</srv><request empty="false"><param>10</param></request></rosservice>
					</data>
				</datamodel>
				<invoke type="ROS_SERVICE" />
				<transition event="succeeded" target="CoverageThreads" />
			</state>
			
<!-- 			<state id="TakeOff"> -->
<!-- 				<datamodel> -->
<!-- 					<data id="invoke"><rosaction><name>cpswarm/cmd/takeoff</name><action>TakeOff</action><goal type="object"><param>10</param></goal></rosaction> -->
<!-- 					</data> -->
<!-- 				</datamodel> -->
<!-- 				<invoke type="ROS_ACTION" /> -->
<!-- 				<transition event="succeeded" target="TakeOff" /> -->
<!-- 			</state> -->
			
			<!-- ******************** COVERAGE ******************** -->
			<parallel id="CoverageThreads">
			
				<state id="Coverage">
					<datamodel>
						<data id="invoke"><rosaction><name>uav_coverage</name><action>Empty</action><goal type="empty"></goal></rosaction>
						</data>
					</datamodel>
					<invoke type="ROS_ACTION" />
				</state>
				
				<state id="CoverageEventMonitoring">
					<datamodel>
						<data id="invoke"><rosmonitor><topic>TO BE DEFINED</topic><msg>Bool</msg></rosmonitor>
						</data>
					</datamodel>
					<invoke type="ROS_MONITOR" />
				</state>
				
				<transition event="targetFound" target="SelectRover" />				
			</parallel>
			
			<!-- ******************** SELECT ROVER ******************** -->			
			<state id="SelectRover">
				<datamodel>
					<data id="invoke"><rosaction><name>cmd/assignTask</name><action>Empty</action><goal type="empty"></goal></rosaction>
					</data>
				</datamodel>
				<invoke type="ROS_ACTION" />
			</state>
			
			<!-- ******************** TRACKING ******************** -->
<!-- 			<parallel id="TrackingThreads"> -->
			
<!-- 				<state id="Tracking"> -->
<!-- 					<datamodel> -->
<!-- 						<data id="invoke"><rosaction><name>uav_tracking</name><action>Empty</action><goal type="empty"></goal></rosaction> -->
<!-- 						</data> -->
<!-- 					</datamodel> -->
<!-- 					<invoke type="ROS_ACTION" /> -->
<!-- 				</state> -->
			
<!-- 				<state id="TrackingEventMonitoring"> -->
<!-- 					<invoke type="ROS_MONITOR" /> -->
<!-- 				</state> -->
			
<!-- 				<transition event="targetLost" target="LocalCoverageThreads" /> -->
<!-- 				<transition event="targetRescued" target="CoverageThreads" />	 -->
<!-- 			</parallel> -->

			<!-- ******************** LOCAL COVERAGE ******************** -->	
<!-- 			<parallel id="LocalCoverageThreads"> -->
			
<!-- 				<state id="LocalCoverage"> -->
<!-- 					<datamodel> -->
<!-- 						<data id="invoke"><rosaction><name>uav_local_coverage</name><action>Empty</action><goal type="empty"	></goal></rosaction> -->
<!-- 						</data> -->
<!-- 					</datamodel> -->
<!-- 					<invoke type="ROS_ACTION" /> -->
<!-- 				</state> -->
				
<!-- 				<state id="CoverageEventMonitoring"> -->
<!-- 					<invoke type="ROS_MONITOR" /> -->
<!-- 				</state> -->
				
<!-- 				<transition event="targetLost" target="CoverageThreads" /> -->
<!-- 				<transition event="targetFound" target="Tracking" />				 -->
<!-- 			</parallel> -->
			
		</state>

		<!-- ******************** SAR EVENT MONITORING ******************** -->
		<state id="SarEventMonitoring">
			<datamodel>
				<data id="invoke"><rosmonitor><topic>TO BE DEFINED</topic><msg>Bool</msg></rosmonitor>
				</data>
			</datamodel>
			<invoke type="ROS_MONITOR" />
		</state>
		
		<transition event="missionAbort" target="MissionAbort" />
		<transition event="emergencyEvent" target="EmergencyRoutine" />

	</parallel>

	<!-- ******************** MISSION ABORT ******************** -->
	<state id="MissionAbort">

	</state>

	<!-- ******************** EMERGENCY ROUTINE ******************** -->
	<state id="EmergencyRoutine">

	</state>

</scxml>